<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>todo List</title>
    <style>
        body {
            background-color: rgb(245, 245, 245);
        }

        .btnGroup {

            /* width: 45px; */
            display: inline-block;
        }

        .itemComplete {
            width: 550px;
            height: 59px;
            background-color: #fff;
            list-style-type: none;
            border-bottom: .8px solid #999;
        }

        .itemComplete .btnName {
            float: left;
            width: 435px;
            height: 40px;
            font-size: 32px;
            border-style: none;
            padding: 7.5px 0px 7.5px 7.5px;
        }

        .itemComplete .btnName-searched {
            float: left;
            width: 435px;
            height: 40px;
            font-size: 32px;
            background-color: red;
            border-style: none;
            padding: 7.5px 0px 7.5px 7.5px;
        }

        /* .itemComplete .btnName:hover {
            float: left;
            width: 435px;
            height: 40px;
            font-size: 32px;
            padding: 7.5px 0px 7.5px 7.5px;
            border-style: none;
        } */

        .itemComplete-searched {
            width: 550px;
            height: 59px;
            background-color: red;
            list-style-type: none;
            border-bottom: .8px solid #999;
        }

        .iconComplete {
            float: left;
            width: 34px;
            height: 34px;
            border: 1px solid #ddd;
            border-radius: 50%;
            margin: 12px 12px 12px 12px;
            /* line-height: 20px; */
            text-align: center;

        }



        .iconCompleteActive {
            /* border-color: green; */
            /* text-align: center; */
            display: inline;
            margin-top: 9px;
        }

        .iconCompleteActive:before {
            content: "√";
            font-size: 25px;
            color: green;
        }

        .iconText {
            color: #999;
            text-decoration: line-through;
        }

        .iconText1 {
            color: red;
        }

        .todo-list {
            margin: 0;
            padding: 0;
            list-style: none;
        }



        .head {
            width: 550px;
            margin: 0px auto;
            overflow: hidden;
        }

        .usecount {
            float: right;
            margin: 5px 4px 3px 0;
        }

        .todoapp {
            margin: 100px auto 10px;
            width: 550px;
            font-size: 80px;
            font-weight: 700;
            text-align: center;
            color: #b83f45;
        }

        .input-search {
            margin-bottom: 10px;
            margin-right: 2px;
            border-style: none;
            text-indent: 2em;
            font-weight: 400;
            /* float: right; */
            width: 200px;
            height: 33px;
            background-color: #fff;
            border-radius: 1%;
            box-shadow: 0 -1px 5px 0 rgba(0, 0, 0, 0.2);
        }

        .input-todo {
            /* margin: 1px 0 1px 560px; */
            margin-right: 2px;
            border-style: none;
            width: 474px;
            height: 33px;
            padding: 16px 16px 16px 60px;
            font-size: 24px;
            background-color: #fff;
            border-radius: 1%;
            box-shadow: 0 -1px 5px 0 rgba(0, 0, 0, 0.2);
        }

        .body {
            width: 550px;
            margin: 0 auto;
        }

        .filter-btn-group {
            display: inline-block;
            margin-left: 30px;
        }

        .useCount {
            color: red;
        }

        .send-time {
            float: right;
        }

        .info {
            margin: 65px auto 0;
            color: #4d4d4d;
            font-size: 11px;
            text-shadow: 0 1px 0 rgba(186, 183, 183, 0.819);
            text-align: center;
        }

        .todo-list li .btnGroup {
            float: right;
        }

        .todo-list li .btnDelete {
            top: 0;
            right: 10px;
            bottom: 0;
            width: 40px;
            height: 59px;
            margin: auto 0;
            font-size: 30px;
            color: #949494;
            background-color: #fff;
            border: none;
        }


        .todo-list li .btnDelete:after {
            content: '×';
            display: block;
            height: 50%;
            line-height: 1.1;
        }

        .todo-list li .btnDelete-searched {
            top: 0;
            right: 10px;
            bottom: 0;
            width: 40px;
            height: 59px;
            margin: auto 0;
            font-size: 30px;
            color: #949494;
            background-color: red;
            border: none;
        }


        .todo-list li .btnDelete-searched:after {
            content: '×';
            display: block;
            background-color: red;
            height: 50%;
            line-height: 1.1;
        }

        .father {

            position: relative;
            margin-bottom: 1px;
        }

        .usecount {
            position: absolute;
            bottom: 0;
            right: 0;
        }

        .footer {
            width: 550px;
            height: 50px;
            background-color: #fff;
        }

        ul {
            display: block;
            list-style-type: disc;
            margin-block-start: 0em;
            margin-block-end: 0em;
            margin-inline-start: 0px;
            margin-inline-end: 0px;
            padding-inline-start: 0px;
        }

        li {
            list-style: none;
        }

        .footer li {
            display: inline-block;
        }

        .num {
            margin-left: 12px;
            margin-top: 14.5px;
        }
    </style>

</head>

<body>
    <div class="head">
        <h1 class="todoapp">todo List</h1>
        <input class="input-search" type="text" placeholder="搜你想搜">
        <div class="father">
            <input class="input-todo" type="text" placeholder="你想做点什么呢？">
            <div class="usecount"><span class="useCount">0</span>/1000</div>
        </div>
    </div>
    <div class="body">
        <ul class="todo-list"></ul>
        <ul class="footer">
            <li class="num"><span class="active-num"></span>&nbsp;item&nbsp;left</li>
        </ul>
    </div>
    <footer class="info">
        <p>Created by HQZhen12</p>
        <p>Maintenanced by the HQZhen12</p>
        <p>Part of HQZhen12</p>
    </footer>
</body>

<script>
    function getLocalNum() {
        let number = localStorage.getItem('num')
        if (number)//如果本地存储有数组则返回JSON.parse()之后的对象
            return JSON.parse(number)
        else {//如果本地存储没有数据,则默认写入三条数据,注意存储的利用JSON.stringify()存储JSON格
            var num = 0
            localStorage.setItem('num', JSON.stringify(num))
        }
    }
    getLocalNum()
    var num = getLocalNum()
    document.querySelector('.active-num').innerHTML = num
    //读取本地存储的数据封装为函数
    //需求阄：读取本地存储数据（封装函数）
    //
    //如果本地存储有数据，则返回JS0N.parse()之后的对象
    //  
    // 如果本地存储没有数据，则默认写入三条数据，注意存储的利用JS0N.stringify()存储) JSON格式
    function getLocalData() {
        let data = localStorage.getItem('data')
        if (data)//如果本地存储有数组则返回JSON.parse()之后的对象
            return JSON.parse(data)
        else {//如果本地存储没有数据,则默认写入三条数据,注意存储的利用JSON.stringify()存储JSON格
            let list = []
            localStorage.setItem('data', JSON.stringify(list))
        }
    }
    getLocalData()
    let inputTodo = document.querySelector('.input-todo')
    let useCount = document.querySelector('.useCount')
    inputTodo.addEventListener('input', function () {
        console.log(this.value.length)
        useCount.innerHTML = this.value.length
    })
    //需求②：渲染模块
    //先读取本地存储数据，然后渲染
    let list = getLocalData()
    console.log(list);
    render(list);
    //新输入的笔记，插入到所有笔记最前面
    inputTodo.addEventListener('keyup', function (e) {
        //需求③：添加模块
        //注意，先取的最新的本地存储数据，然后追加
        let list = getLocalData()
        //新增了数据，要把新数据存储到本地存储，别忘记转换
        console.log(e)
        if (e.key === 'Enter') {
            // || !e.target.valve.trim()
            if (e.target.value === '') {
                e.target.value = ''
                useCount.innerHTML = 0
                return alert("内容不能为空！")
            }
            // e.target.valve.trim()
            console.log('按下了回车键')
            var item =
            {
                name: e.target.value,
                complete: 'false'
            }
            list.unshift(item)
            num++;
            localStorage.setItem('num', JSON.stringify(num))
            document.querySelector('.active-num').innerHTML = num
            localStorage.setItem('data', JSON.stringify(list))
            list = getLocalData()
            render(list);
            // var oLi = document.createElement("li");//增加一个li新节点
            // oLi.innerHTML =
            //     `<li class="itemComplete">
            //         <span class="iconComplete"></span>
            //         <input class="btnName" value="${item.name}">
            //         <div class="btnGroup">
            //             <button class="btnDelete"></button>
            //             <p class="send-time">发布于${new Date().toLocaleString()}</p>
            //     </div>
            //     </li>`
            e.target.value = ''
            useCount.innerHTML = 0
            //点击圆圈修改样式
            let icon = document.querySelectorAll('.iconComplete')
            let text = document.querySelectorAll('.btnName')
            for (let i = 0; i < icon.length; i++)
                icon[i].addEventListener('click', function () {
                    if (icon[i].className.includes('iconCompleteActive')) {
                        icon[i].classList.remove('iconCompleteActive');
                        icon[i].classList.remove('iconCompleteActive:before');
                        text[i].classList.remove('iconText');
                        list[i].complete = 'false'
                        console.log(list[i].complete);
                        num++;
                        console.log(num);
                        localStorage.setItem('num', JSON.stringify(num))
                        document.querySelector('.active-num').innerHTML = num
                    }
                    else {
                        icon[i].classList.add('iconCompleteActive');
                        icon[i].classList.add('iconCompleteActive:before');
                        text[i].className = 'iconText';
                        list[i].complete = 'true'
                        console.log(list[i].complete)
                        num--;
                        console.log(num);
                        localStorage.setItem('num', JSON.stringify(num))
                        document.querySelector('.active-num').innerHTML = num
                    }
                    localStorage.setItem('data', JSON.stringify(list))
                })
        }
    })
    //用户删除某一条笔记
    let Delete = document.querySelectorAll('.btnDelete')
    for (let i = 0; i < Delete.length; i++) {
        Delete[i].addEventListener('click', function () {
            // console.log(e)
            console.log(11);
            list.splice(i, 1)
            num--;
            localStorage.setItem('num', JSON.stringify(num))
            document.querySelector('.active-num').innerHTML = num
            localStorage.setItem('data', JSON.stringify(list))
            render(list)
        })
    }
    //用户修改某一条之前的笔记(双击修改)
    let change = document.querySelectorAll('.todo-list .btnName')
    for (let i = 0; i < change.length; i++) {
        console.log(change[i]);
        change[i].addEventListener('keyup', function (e) {
            if (e.key === 'Enter') {
                // e.target.valve.trim()
                if (e.target.value === '') {
                    e.target.value = ''
                    useCount.innerHTML = 0
                    return alert("内容不能为空！");
                }

                console.log('按下了回车键')
                var item =
                {
                    name: e.target.value,
                    complete: list[i].complete
                }
                list[i] = item
                localStorage.setItem('data', JSON.stringify(list))
                list = getLocalData()
                render(list);
            }
        })
    }
    //遍历伪数组
    function render(list) {
        var html = '';
        list.forEach((item, index, list) => {
            if (item.complete === 'false') {
                html = html +
                    `<li class="itemComplete">
                    <span class="iconComplete"></span>
                    <input class="btnName" value="${item.name}">
                        <button class="btnDelete"></button>
                    </div>
                </li>`
            }
            else {
                html = html +
                    `<li class="itemComplete">
                    <span class="iconComplete iconCompleteActive iconCompleteActive:before"></span>
                    <input class="btnName iconText" value="${item.name}">
                    <div class="btnGroup">
                        <button class="btnDelete"></button>
                    </div>
                    </li>`
            }
        })
        // console.log(html);
        document.querySelector('.todo-list').innerHTML = html
    }
    //点击圆圈修改样式
    let icon = document.querySelectorAll('.iconComplete')
    let text = document.querySelectorAll('.btnName')
    for (let i = 0; i < icon.length; i++)
        icon[i].addEventListener('click', function () {
            if (icon[i].className.includes('iconCompleteActive')) {
                icon[i].classList.remove('iconCompleteActive');
                icon[i].classList.remove('iconCompleteActive:before');
                text[i].classList.remove('iconText');
                list[i].complete = 'false'
                console.log(list[i].complete);
                num++;
                console.log(num);
                localStorage.setItem('num', JSON.stringify(num))
                document.querySelector('.active-num').innerHTML = num
            }
            else {
                icon[i].classList.add('iconCompleteActive');
                icon[i].classList.add('iconCompleteActive:before');
                text[i].classList.add('iconText');
                list[i].complete = 'true'
                console.log(list[i].complete);
                num--;
                console.log(num);
                localStorage.setItem('num', JSON.stringify(num))
                document.querySelector('.active-num').innerHTML = num
            }
            localStorage.setItem('data', JSON.stringify(list))

        })
    //搜索框对应高亮
    // console.log(ARR);
    let ARR = list.map(val => {
        return val.name
    })
    let search = document.querySelector('.input-search')
    search.addEventListener('keyup', function (e) {
        console.log(e.target.value);
        for (let i = 0; i < ARR.length; i++) {
            console.log(ARR[i].includes(e.target.value));
            //&& (!e.target.value === '')
            if (e.target.value === '') {
                text[i].classList.remove('iconText1')
                continue
            }
            if (ARR[i].includes(e.target.value)) {
                text[i].classList.add('iconText1')
            }
            else {
                text[i].classList.remove('iconText1')
            }
        }
    })
    search.addEventListener('blur', function (e) {
        console.log(12);
        for (let i = 0; i < ARR.length; i++) {
            text[i].classList.remove('iconText1')
        }
        e.target.value = ''
    })
</script>
</body>

</html>